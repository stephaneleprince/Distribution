{# todo : this needs to be removed and be managed server side #}
<script src='{{ asset('bundles/clarolinecore/js/iframe/iframe.js') }}'></script>

{# Base libraries #}
<script src="{{ hotAsset('dist/scaffolding_dll.js') }}"></script>

{# React/Redux & related libraries #}
<script src="{{ hotAsset('dist/react_dll.js') }}"></script>

{# AngularJS & related libraries #}
<script src="{{ hotAsset('dist/angular_dll.js') }}"></script>

{# Frequently used Claroline JS #}
<script src="{{ hotAsset('dist/commons.js') }}"></script>

{# Polyfills #}
<script src="{{ hotAsset('dist/claroline-distribution-main-core-polyfills.js') }}"></script>

<script>
    if (window.sessionStorage.getItem('hide_brower_warning')) {
        $('.outdated-browser-warning').hide();
    }
</script>

{# TODO: remove this when custom js builds are available #}
{# ATTENTION : it must be loaded before Bootstrap to override `.tooltip()` method #}
<script src="{{ asset('packages/jquery-ui-dist/jquery-ui.min.js') }}"></script>

{% javascripts debug=false filter='jsmin' output='vendor/twitter/bootstrap/js/bootstrap.js'
    'packages/bootstrap/js/transition.js'
    'packages/bootstrap/js/alert.js'
    'packages/bootstrap/js/button.js'
    'packages/bootstrap/js/carousel.js'
    'packages/bootstrap/js/collapse.js'
    'packages/bootstrap/js/dropdown.js'
    'packages/bootstrap/js/modal.js'
    'packages/bootstrap/js/scrollspy.js'
    'packages/bootstrap/js/tab.js'
    'packages/bootstrap/js/tooltip.js'
    'packages/bootstrap/js/popover.js'
    'packages/bootstrap/js/affix.js'
    %}<script src="{{ asset_url }}"></script>
{% endjavascripts %}

{% javascripts debug=false output='vendor/jms/twig-js/twig.js'
    '../vendor/jms/twig-js/twig.js'
%}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}
{% javascripts debug=false filter='twig_js, jsmin' vars=["locale"]
    "@ClarolineCoreBundle/Resources/views/Resource/breadcrumbs.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/actions.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/filters.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/listElement.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/thumbnail.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/results.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/roles.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/tabs.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/treenode.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/deleteConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/publishConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/unpublishConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Resource/userRightsRow.html.twig"
    "@ClarolineCoreBundle/Resources/views/Modal/modal.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Modal/validationFooter.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Modal/errorFooter.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/confirmAddRole.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/removeGroupConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/removeUserConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/removeMessageConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/restoreMessageConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/resetPasswordConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/addUserConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/roles/roleUserLabel.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/roles/roleGroupLabel.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/removeWorkspacesConfirm.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/ConfirmationMessage/noRoleSelected.html.twigjs"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/parameters/model/modelRow.html.twig"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/parameters/model/userRow.html.twig"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/parameters/model/groupRow.html.twig"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/parameters/model/resourceElement.html.twig"
    "@ClarolineCoreBundle/Resources/views/Tool/workspace/parameters/model/tabElement.html.twig"
%}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}

{# We have replaced WillDurand by our own to be able to lazy load trans domains #}
<script src="{{ hotAsset('dist/claroline-distribution-main-core-translator.js') }}"></script>

{# Load some default translation domains #}
{% javascripts debug=false
    'js/translations/resource/*.js'
    'js/translations/home/*.js'
    'js/translations/platform/*.js'
    'js/translations/error/*.js'
    'js/translations/validators/*.js'
    'js/translations/alerts/*.js'
%}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}

<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>
<script src="{{ asset('packages/bootstrap-datepicker/dist/js/bootstrap-datepicker.js') }}"></script>
{% if 'en' != app.request.locale %}
    <script src="{{ asset('packages/bootstrap-datepicker/js/locales/bootstrap-datepicker.' ~ app.request.locale ~ '.js') }}"></script>
{% endif %}

<script src="{{ asset('packages/underscore/underscore.js') }}"></script>
<script src="{{ asset('packages/backbone/backbone.js') }}"></script>

{% javascripts debug=false filter='jsmin' output='vendor/claroline/js/libraries.js'
    '@ClarolineCoreBundle/Resources/public/js/common.js'
    '@ClarolineCoreBundle/Resources/public/js/modal.js'
    '@ClarolineCoreBundle/Resources/public/js/simplerights.js'
    '@ClarolineCoreBundle/Resources/public/js/sidebar.js'
    '@ClarolineCoreBundle/Resources/public/js/topbar.js'
    '@ClarolineCoreBundle/Resources/public/js/checkbox-dropdown.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/actions.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/breadcrumbs.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/confirm.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/filters.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/form.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/rights.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/nodes.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/thumbnail.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resource/listElement.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/resources.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/master.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/tabs.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/widgets.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/treelist.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/treenode.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/views/tabpanes.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/router.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/server.js'
    '@ClarolineCoreBundle/Resources/public/js/resource/manager/manager.js'
    '@ClarolineCoreBundle/Resources/public/js/home/home.js'
    '@ClarolineCoreBundle/Resources/public/js/locale.js'
    '@ClarolineCoreBundle/Resources/public/js/resourceinput.js'
    '@ClarolineCoreBundle/Resources/public/js/utilities.js'
    '@ClarolineCoreBundle/Resources/public/js/startup.js'
    '@ClarolineCoreBundle/Resources/public/js/user/user_picker.js'
%}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}

{# TinyMCE #}
<script src="{{ asset('bundles/stfalcontinymce/vendor/tinymce/tinymce.jquery.min.js') }}"></script>
<script src="{{ asset('bundles/stfalcontinymce/vendor/tinymce/jquery.tinymce.min.js') }}"></script>

{% if asset_exists("bundles/stfalcontinymce/vendor/tinymce/langs/" ~ app.request.locale ~ ".js") %}
    <script src="{{ asset("bundles/stfalcontinymce/vendor/tinymce/langs/" ~ app.request.locale ~ ".js") }}"></script>
{% elseif asset_exists("bundles/stfalcontinymce/vendor/tinymce/langs/" ~ app.request.locale ~ "_" ~ app.request.locale | upper ~ ".js") %}
    <script src="{{ asset("bundles/stfalcontinymce/vendor/tinymce/langs/" ~ app.request.locale ~ "_" ~ app.request.locale | upper ~ ".js") }}"></script>
{% else %}
    <script src="{{ asset("bundles/stfalcontinymce/vendor/tinymce/langs/en_GB.js") }}"></script>
{% endif %}

<script src="{{ hotAsset('dist/claroline-distribution-main-core-tinymce.js') }}"></script>
{% javascripts debug=false filter='jsmin' output='vendor/claroline/js/tinymce.js'
    '@ClarolineCoreBundle/Resources/public/js/tinymce/resource_picker_button.js'
    '@ClarolineCoreBundle/Resources/public/js/tinymce/resource_picker.js'
    '@ClarolineCoreBundle/Resources/public/js/tinymce/resource_upload_button.js'
%}
    <script src="{{ asset_url }}"></script>
{% endjavascripts %}

<script>
    $('body').tooltip({
        selector: '[data-toggle=tooltip]'
    });

    $('.maintenance-popover').popover();

    $('#hide-email-confirmation').on('click', function () {
        $.ajax({
            url: Routing.generate('claro_security_validate_email_hide'),
            type: 'GET',
            success: function () {
                $('.alert-email-confirm').hide();
            }
        });
    });

    $('#close-browser-warning').on('click', function(event) {
        window.sessionStorage.setItem('hide_brower_warning', true);
    })

    // The following code fixes the issue of unscrollable modal due to focus loss when multiple modals are opened.
    var oldJqTrigger = jQuery.fn.trigger;
    jQuery.fn.trigger = function () {
        if ( arguments && arguments.length > 0) {
            if (typeof arguments[0] === 'string') {
                if (arguments[0] === 'hidden.bs.modal') {
                    if ($('.modal:visible').length) {
                        $('.modal-backdrop').first().css('z-index', parseInt($('.modal:visible').last().css('z-index')) - 10);
                        $('body').addClass('modal-open');
                    }
                }
            }
        }
        return oldJqTrigger.apply(this, arguments);
    };
</script>

{{ render(controller('ClarolineCoreBundle:Layout:injectJavascript', {})) }}
